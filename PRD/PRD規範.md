# PRD 撰寫規範 v1.0

## 規範說明

本規範定義了 PRD（Product Requirement Document，產品需求文件）的撰寫標準，主要受眾為 **PM、工程師、設計師**三個角色。

### 核心原則
1. **PRD 是活文件**：需求會隨討論和開發過程持續調整，需有版本控制和異動記錄
2. **清晰勝於完美**：優先確保邏輯清楚、術語一致，而非追求完美細節
3. **脈絡優先**：說明「為什麼」比「做什麼」更重要
4. **可驗證性**：每個功能都要有明確的驗收標準

---

## PRD 文件結構

### 1. 文件資訊區

#### 目的
提供文件版本追蹤和異動歷史，確保所有人都能掌握最新變更。

#### 撰寫規範
```markdown
# [專案名稱] PRD

**版本**：v20250203  
**最後更新**：2025/02/03  
**負責 PM**：[姓名]  
**相關人員**：[工程師姓名]、[設計師姓名]

## 變更日誌（近期異動）
> 此區塊僅保留近三天的異動，每週或每個 Sprint 結束後歸檔至修訂歷史

| 日期 | 受影響模組 | 異動內容 | 原因 | 錨點連結 |
|------|-----------|---------|------|---------|
| 02/03 | 購物車 | 調整 API 欄位從 ID 改為 UUID | 配合後端架構 | [跳轉](#購物車功能) |
| 02/02 | 付款功能 | 移除「貨到付款」選項 | 時程壓力，延後至 v2.0 | [跳轉](#付款功能) |

## 修訂歷史
| 版本 | 日期 | 異動摘要 | 修訂人 |
|------|------|---------|--------|
| v20250203 | 2025/02/03 | 調整購物車 API 規格 | [PM 姓名] |
| v20250201 | 2025/02/01 | 初版完成 | [PM 姓名] |
```

#### 注意事項
- 版本號使用時間戳記格式：`vYYYYMMDD`
- 變更日誌需附上錨點連結，方便快速定位
- 異動內容需說明「做了什麼」和「為什麼」

---

### 2. 名詞定義

#### 目的
集中定義所有關鍵術語，確保 PM、工程師、設計師對專案術語有一致理解。

#### 撰寫規範

**業務術語**
```markdown
## 名詞定義

### 業務術語

| 術語 | 定義 | 備註 |
|------|------|------|
| 購物車 | 使用者暫存欲購買商品的清單，支援新增、刪除、修改數量 | - |
| 有效商品 | 庫存 > 0 且狀態為「上架中」的商品 | 下架商品會從購物車自動移除 |
| 訪客 | 未登入的使用者 | 訪客的購物車資料存於瀏覽器 localStorage |
| 會員 | 已登入的使用者 | 會員的購物車資料存於後端資料庫 |
| 小計 | 單一商品的總價，計算公式：單價 × 數量 | - |
| 總金額 | 購物車內所有商品的小計加總 | 不含運費、折扣等 |
```

**技術術語**
```markdown
### 技術術語

| 術語 | 定義 | 備註 |
|------|------|------|
| UUID | Universally Unique Identifier，全域唯一識別碼 | 用於購物車 ID、商品 ID 等 |
| localStorage | 瀏覽器本地儲存空間，容量約 5-10MB | 訪客購物車資料存於此 |
| Session | 使用者登入後的會話狀態，通常有時效性 | 會員登入後會建立 Session |
| API Timeout | API 請求逾時時間，本專案設定為 5 秒 | 超過 5 秒視為網路異常 |
| CRUD | Create、Read、Update、Delete，資料的增刪改查操作 | 購物車 API 提供完整 CRUD 功能 |
```

#### 注意事項
- 業務術語和技術術語分開定義，方便不同角色查閱
- 業務術語主要給 PM、設計師看，技術術語主要給工程師看
- 若某術語橫跨兩者（如「購物車 ID」），可在業務術語中定義，技術術語中補充技術細節
- 依照字母順序或使用頻率排列

---

### 3. 問題定義與目標

#### 目的
說明為什麼要做這個專案，要解決什麼問題，讓所有人理解專案的價值和方向。

#### 撰寫規範
```markdown
## 問題定義與目標

### 問題描述
目前使用者在選購商品時，無法暫存欲購買的商品清單，導致：
- 每次需重新搜尋商品，造成操作不便
- 使用者放棄購買的比例較高（約 40%）
- 客服接到大量「如何儲存商品」的詢問

### 目標使用者
- 主要：瀏覽商品但尚未決定購買的使用者
- 次要：需要分批採購的企業採購人員

### 預期目標
1. 降低使用者放棄購買的比例（目標：降至 25%）
2. 提升回購率（目標：提升 15%）
3. 減少客服關於「如何儲存商品」的詢問量（目標：降低 50%）
```

#### 注意事項
- 問題描述需具體，盡量附上數據
- 目標使用者分「主要」和「次要」，避免目標過於分散
- 預期目標需可衡量（即使是粗略估計也比沒有好）

---

### 4. 使用者故事與情境

#### 目的
透過具體情境說明使用者如何使用功能，讓設計師和工程師理解功能的脈絡。

#### 撰寫規範
```markdown
## 使用者故事與情境

### 情境 1：訪客暫存商品
**角色**：訪客（未登入）  
**情境**：小明在瀏覽母親節禮物，看到幾個不錯的商品，但還沒決定要買哪個  
**使用前**：小明必須開多個分頁或截圖記錄商品，很不方便  
**使用後**：小明可以將商品加入購物車，稍後再回來比較和決定

### 情境 2：會員跨裝置購物
**角色**：會員（已登入）  
**情境**：小華在手機上加入商品後，回到電腦想繼續購買  
**使用前**：購物車資料無法同步，小華需要重新搜尋商品  
**使用後**：小華在電腦上登入後，購物車資料自動同步，可直接結帳
```

#### 注意事項
- 每個情境要有「角色」、「情境」、「使用前」、「使用後」四個要素
- 情境要具體，避免抽象描述
- 至少涵蓋 2-3 個主要情境

---

### 5. 功能範疇與邊界

#### 目的
明確定義這次專案做什麼、不做什麼，避免範疇蔓延（scope creep）。

#### 撰寫規範
```markdown
## 功能範疇與邊界

### 本次包含的功能
- ✅ 新增商品至購物車
- ✅ 修改購物車內商品數量
- ✅ 刪除購物車內商品
- ✅ 購物車資料跨裝置同步（會員）
- ✅ 購物車商品庫存檢查

### 本次不包含的功能（未來版本考慮）
- ❌ 購物車商品推薦功能
- ❌ 購物車分享給他人
- ❌ 購物車優惠券自動套用

### 已知限制
- **技術限制**：購物車最多儲存 100 件商品（受後端資料庫限制）
- **業務限制**：訪客購物車資料保留 7 天（localStorage 容量考量）
```

#### 注意事項
- 使用 ✅ ❌ 符號增加可讀性
- 「不包含的功能」要說明原因或規劃時程
- 「已知限制」分「技術限制」和「業務限制」

---

### 6. 外部依賴與技術約束

#### 目的
提前揭露外部風險，讓團隊知道哪些事情不在自己掌控範圍內，並提供備援方案降低風險。

#### 撰寫規範
```markdown
## 外部依賴與技術約束

### 後端服務依賴
| 服務名稱 | 依賴內容 | 負責人 | 預計完成日 | 風險等級 | 備援方案 |
|---------|---------|--------|-----------|---------|---------|
| 購物車 API | 提供 CRUD 操作的 RESTful API | 後端工程師 A | 2025/02/15 | 🟢 低 | - |
| 庫存檢查 API | 即時檢查商品庫存狀態 | 後端工程師 B | 2025/02/20 | 🟡 中 | 若延遲，前端暫時跳過即時檢查，結帳時再統一檢查庫存 |

### 第三方服務依賴
| 服務名稱 | 依賴內容 | 預計完成日 | 風險等級 | 備援方案 |
|---------|---------|-----------|---------|---------|
| CDN 圖片服務 | 提供商品圖片載入 | - | 🟡 中 | 若 CDN 異常，改用本地圖片快取或顯示預設圖片 |

### 開發順序約束
1. 必須先完成「購物車 API」才能開始前端開發
2. 「庫存檢查功能」可與購物車並行開發，但上線前必須完成
   - **備援方案**：若「庫存檢查 API」延遲，先上線不含即時檢查的版本，結帳時才檢查庫存

### 技術約束
- 前端需支援 IE 11 以上瀏覽器
- localStorage 儲存上限為 5MB
- API 請求逾時時間設定為 5 秒
```

#### 注意事項
- 風險等級用顏色標示：🟢 低、🟡 中、🔴 高
- 預計完成日要與相關負責人確認
- **備援方案需具體可執行**，避免「再討論」或「待確認」等模糊描述
- 備援方案分兩種：
  - **降級方案**：功能簡化但仍可運作（如：跳過即時檢查，結帳時才檢查）
  - **替代方案**：使用其他技術或服務（如：CDN 異常改用本地快取）
- 若某依賴項目風險等級為🔴高且無備援方案，需特別標註並追蹤

---

### 7. 互動流程與使用者行為

#### 目的
透過流程圖和線框圖說明使用者的操作路徑和系統反應。

#### 撰寫規範
```markdown
## 互動流程與使用者行為

### 主要流程：新增商品至購物車

#### 流程圖
[此處插入線框圖或流程圖]

#### 流程說明
1. 使用者在商品頁點擊「加入購物車」按鈕
2. 系統檢查商品庫存
   - 若庫存 > 0：顯示「已加入購物車」提示，更新購物車數量
   - 若庫存 = 0：顯示「商品已售完」提示，按鈕變為灰色不可點擊
3. 使用者可選擇「繼續購物」或「前往購物車」

### 替代流程：使用者修改商品數量

#### 流程說明
1. 使用者在購物車頁面修改商品數量
2. 系統即時檢查庫存
   - 若修改後數量 ≤ 庫存：更新數量，重新計算總價
   - 若修改後數量 > 庫存：顯示「庫存不足」提示，數量自動調整為最大可購買數量
3. 使用者可繼續修改其他商品或結帳

### 異常流程：網路異常

#### 流程說明
1. 使用者點擊「加入購物車」後，網路連線中斷
2. 系統顯示「網路異常，請稍後再試」提示
3. 按鈕恢復可點擊狀態，使用者可重試
```

#### 注意事項
- 線框圖用來表達「邏輯和流程」，細節（如按鈕位置）以設計稿為準
- 至少涵蓋「主要流程」、「替代流程」、「異常流程」
- 流程說明要清楚描述「使用者做什麼」和「系統反應什麼」

---

### 8. 功能詳述

#### 目的
詳細描述每個功能的實作細節、前置條件、驗收標準。

#### 撰寫規範
```markdown
## 功能詳述

### 功能 1：新增商品至購物車 [設計稿連結](https://figma.com/xxx)

#### 功能描述
使用者可在商品頁點擊「加入購物車」按鈕，將商品加入購物車。系統會即時檢查庫存，並更新購物車數量顯示。

#### 前置條件
1. 商品狀態為「上架中」
2. 商品庫存 > 0

#### 驗收標準（Given/When/Then）

**正常情境**
- **Given** 使用者在商品頁，且商品庫存 > 0
- **When** 使用者點擊「加入購物車」按鈕
- **Then** 
  - 顯示「已加入購物車」綠色提示（3 秒後自動消失）
  - 購物車圖示上的數量 +1
  - 按鈕文字變更為「已在購物車」（3 秒後恢復）

**庫存不足情境**
- **Given** 使用者在商品頁，且商品庫存 = 0
- **When** 使用者查看商品頁
- **Then**
  - 「加入購物車」按鈕顯示為灰色不可點擊
  - 按鈕文字顯示為「已售完」

**重複加入情境**
- **Given** 商品已在購物車中
- **When** 使用者再次點擊「加入購物車」
- **Then**
  - 購物車內該商品數量 +1
  - 若加入後數量 > 庫存，顯示「庫存不足」紅色提示，數量不變

**網路異常情境**
- **Given** 使用者點擊「加入購物車」
- **When** 網路連線中斷或 API 回應超時（> 5 秒）
- **Then**
  - 顯示「網路異常，請稍後再試」紅色提示
  - 按鈕恢復可點擊狀態

---

### 功能 2：修改購物車商品數量 [設計稿連結](https://figma.com/xxx)

#### 功能描述
使用者可在購物車頁面透過「+」「-」按鈕或直接輸入數字，修改商品購買數量。

#### 前置條件
1. 購物車內至少有一件商品
2. 使用者在購物車頁面

#### 驗收標準（Given/When/Then）

**增加數量**
- **Given** 購物車內有商品 A（數量 = 2，庫存 = 10）
- **When** 使用者點擊「+」按鈕
- **Then**
  - 商品數量變為 3
  - 小計金額即時更新
  - 總金額即時更新

**減少數量至 1**
- **Given** 購物車內有商品 A（數量 = 2）
- **When** 使用者點擊「-」按鈕
- **Then**
  - 商品數量變為 1
  - 小計金額即時更新
  - 總金額即時更新

**減少數量至 0**
- **Given** 購物車內有商品 A（數量 = 1）
- **When** 使用者點擊「-」按鈕
- **Then**
  - 顯示確認對話框：「確定要移除此商品？」
  - 使用者點擊「確定」→ 商品從購物車移除
  - 使用者點擊「取消」→ 數量維持為 1

**直接輸入數量**
- **Given** 購物車內有商品 A（庫存 = 10）
- **When** 使用者在數量欄位輸入「5」
- **Then**
  - 商品數量變為 5
  - 小計金額即時更新

**輸入數量超過庫存**
- **Given** 購物車內有商品 A（庫存 = 10）
- **When** 使用者在數量欄位輸入「15」
- **Then**
  - 顯示「庫存不足，最多只能購買 10 件」紅色提示
  - 數量自動調整為 10
```

#### 注意事項
- 每個功能獨立撰寫
- 設計稿連結放在功能標題旁
- 驗收標準使用 Given/When/Then 格式
- 驗收標準需涵蓋「正常情境」和「異常情境」
- 功能顆粒度判斷標準：
  - 不同的使用者操作步驟 → 拆開
  - 同一個畫面的不同元件 → 不拆，寫在同一功能下

---

### 9. 資料與規則定義

#### 目的
定義資料結構、欄位格式、驗證規則，讓工程師知道要處理什麼資料。

#### 撰寫規範
```markdown
## 資料與規則定義

### 購物車資料結構

#### 訪客購物車（localStorage）
```json
{
  "cartId": "guest_20250203_abc123",
  "items": [
    {
      "productId": "P001",
      "productName": "商品名稱",
      "quantity": 2,
      "price": 1000,
      "imageUrl": "https://example.com/image.jpg"
    }
  ],
  "totalAmount": 2000,
  "createdAt": "2025-02-03T10:30:00Z",
  "updatedAt": "2025-02-03T10:35:00Z"
}
```

#### 會員購物車（後端 API）
```json
{
  "cartId": "member_12345_cart",
  "userId": "U12345",
  "items": [
    {
      "productId": "P001",
      "productName": "商品名稱",
      "quantity": 2,
      "price": 1000,
      "imageUrl": "https://example.com/image.jpg",
      "stock": 50
    }
  ],
  "totalAmount": 2000,
  "createdAt": "2025-02-03T10:30:00Z",
  "updatedAt": "2025-02-03T10:35:00Z"
}
```

### 欄位說明與驗證規則

| 欄位名稱 | 型別 | 必填 | 驗證規則 | 說明 |
|---------|------|------|---------|------|
| cartId | String | ✅ | - | 購物車唯一識別碼 |
| userId | String | ❌ | - | 會員 ID（訪客為空） |
| productId | String | ✅ | 格式：P + 3 位數字 | 商品 ID |
| productName | String | ✅ | 長度 ≤ 100 字元 | 商品名稱 |
| quantity | Integer | ✅ | 1 ≤ quantity ≤ 999 | 購買數量 |
| price | Integer | ✅ | ≥ 0 | 商品單價（單位：元） |
| stock | Integer | ✅ | ≥ 0 | 商品庫存 |
| totalAmount | Integer | ✅ | ≥ 0 | 總金額（自動計算） |

### 資料流向

```
[前端] → [後端 API] → [資料庫]
  ↓           ↓            ↓
加入商品   檢查庫存    儲存購物車
  ↓           ↓            ↓
顯示結果   回傳結果    更新資料
```

### 業務規則
1. **購物車數量上限**：訪客購物車最多 50 件商品，會員購物車最多 100 件商品
2. **商品數量上限**：單一商品最多購買 999 件
3. **資料保留期限**：訪客購物車資料保留 7 天，會員購物車永久保留
4. **價格計算規則**：總金額 = Σ (商品單價 × 購買數量)


#### 注意事項
- 資料結構使用 JSON 格式範例
- 驗證規則需明確（長度、範圍、格式）
- 資料流向可用簡單的文字圖表示
- 業務規則需清楚說明數字邏輯

---

### 10. 邊界條件與異常處理

#### 目的
預先定義各種邊界情況和異常的處理方式，避免開發時才發現漏洞。

#### 撰寫規範
```markdown
## 邊界條件與異常處理

### 資料邊界
| 情境 | 系統行為 | UI 顯示 |
|------|---------|---------|
| 購物車為空 | 顯示空狀態頁面 | 「購物車是空的，去逛逛吧！」+ 推薦商品 |
| 購物車商品數量 = 上限（50/100） | 禁止再加入商品 | 「購物車已滿，請先結帳或移除部分商品」 |
| 商品數量 = 999 | 「+」按鈕變灰色不可點擊 | - |
| 商品庫存 = 0 | 商品顯示「已售完」標籤 | 「此商品已售完」 |
| 輸入數量為非數字 | 自動恢復為原數量 | 「請輸入有效數量」紅色提示 |
| 輸入數量為負數或 0 | 自動恢復為原數量 | 「數量需大於 0」紅色提示 |

### 權限處理
| 情境 | 系統行為 | UI 顯示 |
|------|---------|---------|
| 訪客存取會員限定功能 | 跳轉至登入頁 | 「請先登入以繼續」 |
| 會員 Session 過期 | 強制登出，跳轉至登入頁 | 「登入逾時，請重新登入」 |

### 系統異常
| 情境 | 系統行為 | UI 顯示 |
|------|---------|---------|
| API 回應超時（> 5 秒） | 顯示錯誤提示，允許重試 | 「網路異常，請稍後再試」 |
| API 回應 500 錯誤 | 顯示錯誤提示，聯絡客服 | 「系統異常，請聯絡客服」 |
| localStorage 容量不足 | 清除過期資料，重試儲存 | 若仍失敗：「儲存失敗，請清理瀏覽器資料」 |
| 網路斷線 | 顯示離線狀態，禁用需網路的功能 | 「目前處於離線狀態」 |

### 操作衝突
| 情境 | 系統行為 | UI 顯示 |
|------|---------|---------|
| 商品在購物車中被其他使用者搶購一空 | 自動移除該商品，發送通知 | 「[商品名稱] 已售完，已自動移除」 |
| 使用者在多裝置同時修改購物車 | 以最後一次操作為準（後端時間戳） | - |
```

#### 注意事項
- 使用表格整理，方便查閱
- 分類清楚：資料邊界、權限處理、系統異常、操作衝突
- 每個情境都要有「系統行為」和「UI 顯示」
- UI 提示文字要具體，避免模糊

---

### 11. 優先級

#### 目的
明確各功能的開發優先順序，並說明調整原因。

#### 撰寫規範
```markdown
## 優先級

### 優先級定義
- **必做（P0）**：解決核心痛點，沒有此功能產品無法運作
- **中（P1）**：改善使用者體驗，有明顯價值但不影響核心功能
- **低（P2）**：輔助性功能，提升便利性但非必要

### 功能優先級清單

| 功能 | 優先級 | 調整原因 |
|------|-------|---------|
| 新增商品至購物車 | P0 | 核心功能，沒有此功能產品無法運作 |
| 修改購物車商品數量 | P0 | 核心功能，使用者必須能調整數量 |
| 刪除購物車商品 | P0 | 核心功能，使用者必須能移除商品 |
| 購物車資料跨裝置同步（會員） | P0 | 核心功能，會員期望資料能同步 |
| 購物車商品庫存即時檢查 | P1 | 改善體驗，避免結帳時才發現缺貨 |
| 購物車商品圖片顯示 | P1 | 改善體驗，但不影響核心功能 |
| 購物車空狀態推薦商品 | P2 | 輔助功能，提升轉換率但非必要 |
| 購物車總價顯示折扣資訊 | P2 | 原為 P1，因技術依賴優惠券系統（尚未完成），調整為 P2 |
```

#### 注意事項
- 優先級分為三級：P0（必做）、P1（中）、P2（低）
- 調整原因需說明具體理由（技術依賴、時程壓力、業務需求變更等）
- 若優先級有調整，需在「調整原因」欄位註明

---

## PRD 撰寫檢查清單

在 PRD 完成後，使用此檢查清單確認品質：

### 完整性檢查
- [ ] 文件資訊區：版本號、變更日誌、修訂歷史
- [ ] 名詞定義：所有關鍵術語都有定義
- [ ] 問題定義與目標：清楚說明為什麼做、要達成什麼
- [ ] 使用者故事與情境：至少 2-3 個情境
- [ ] 功能範疇與邊界：明確定義做什麼、不做什麼
- [ ] 外部依賴與技術約束：列出所有依賴項目
- [ ] 互動流程與使用者行為：主要流程、替代流程、異常流程
- [ ] 功能詳述：每個功能都有前置條件和驗收標準
- [ ] 資料與規則定義：資料結構、驗證規則、業務規則
- [ ] 邊界條件與異常處理：涵蓋各種邊界和異常情況
- [ ] 優先級：每個功能都有優先級標註

### 一致性檢查
- [ ] 名詞使用前後一致
- [ ] 資料欄位名稱與 API 文件一致
- [ ] 驗收標準與功能描述一致

### 清晰度檢查
- [ ] 所有術語都有明確定義
- [ ] 驗收標準使用 Given/When/Then 格式
- [ ] 異常處理有明確的系統行為和 UI 顯示
- [ ] 優先級調整有說明原因

### 可執行性檢查
- [ ] 工程師能根據 PRD 開始開發
- [ ] 設計師能根據 PRD 設計 UI
- [ ] 測試人員能根據驗收標準撰寫測試案例

---

## 附錄

### 常見問題

**Q1：PRD 要寫到多細？**  
A：細到工程師和設計師「不需要再問 PM」就能開始工作。如果發現團隊常常回來問問題，代表 PRD 不夠細。

**Q2：設計稿還沒出來，PRD 能先寫嗎？**  
A：可以。使用線框圖表達邏輯和流程，設計稿出來後再補上連結即可。

**Q3：開發到一半需求變更，PRD 怎麼辦？**  
A：更新 PRD，在變更日誌記錄異動，並通知相關人員。PRD 是活文件，需求變更是正常的。

**Q4：PRD 和 API 文件的關係？**  
A：PRD 定義「要做什麼」，API 文件定義「技術實作細節」。PRD 中的資料結構應與 API 文件一致。

**Q5：驗收標準寫太多會不會太冗長？**  
A：不會。驗收標準越詳細，開發時爭議越少，測試時遺漏越少。寧可詳細也不要模糊。

---

**文件結束**