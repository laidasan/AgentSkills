# 購物車功能 PRD

**版本**：v20250203
**最後更新**：2025/02/03
**負責 PM**：王小明
**相關人員**：李工程師、張設計師

## 變更日誌（近期異動）
> 此區塊僅保留近三天的異動，每週或每個 Sprint 結束後歸檔至修訂歷史

| 日期 | 受影響模組 | 異動內容 | 原因 | 錨點連結 |
|------|-----------|---------|------|---------|
| 02/03 | 購物車 | 調整 API 欄位從 ID 改為 UUID | 配合後端架構 | [跳轉](#功能詳述) |
| 02/02 | 付款功能 | 移除「貨到付款」選項 | 時程壓力，延後至 v2.0 | - |

## 修訂歷史
| 版本 | 日期 | 異動摘要 | 修訂人 |
|------|------|---------|--------|
| v20250203 | 2025/02/03 | 調整購物車 API 規格 | 王小明 |
| v20250201 | 2025/02/01 | 初版完成 | 王小明 |

---

## 名詞定義

### 業務術語

| 術語 | 定義 | 備註 |
|------|------|------|
| 購物車 | 使用者暫存欲購買商品的清單，支援新增、刪除、修改數量 | - |
| 有效商品 | 庫存 > 0 且狀態為「上架中」的商品 | 下架商品會從購物車自動移除 |
| 訪客 | 未登入的使用者 | 訪客的購物車資料存於瀏覽器 localStorage |
| 會員 | 已登入的使用者 | 會員的購物車資料存於後端資料庫 |
| 小計 | 單一商品的總價，計算公式：單價 × 數量 | - |
| 總金額 | 購物車內所有商品的小計加總 | 不含運費、折扣等 |

### 技術術語

| 術語 | 定義 | 備註 |
|------|------|------|
| UUID | Universally Unique Identifier，全域唯一識別碼 | 用於購物車 ID、商品 ID 等 |
| localStorage | 瀏覽器本地儲存空間，容量約 5-10MB | 訪客購物車資料存於此 |
| Session | 使用者登入後的會話狀態，通常有時效性 | 會員登入後會建立 Session |
| API Timeout | API 請求逾時時間，本專案設定為 5 秒 | 超過 5 秒視為網路異常 |
| CRUD | Create、Read、Update、Delete，資料的增刪改查操作 | 購物車 API 提供完整 CRUD 功能 |

---

## 問題定義與目標

### 問題描述
目前使用者在選購商品時，無法暫存欲購買的商品清單，導致：
- 每次需重新搜尋商品，造成操作不便
- 使用者放棄購買的比例較高（約 40%）
- 客服接到大量「如何儲存商品」的詢問

### 目標使用者
- 主要：瀏覽商品但尚未決定購買的使用者
- 次要：需要分批採購的企業採購人員

### 預期目標
1. 降低使用者放棄購買的比例（目標：降至 25%）
2. 提升回購率（目標：提升 15%）
3. 減少客服關於「如何儲存商品」的詢問量（目標：降低 50%）

---

## 使用者故事與情境

### 情境 1：訪客暫存商品
**角色**：訪客（未登入）
**情境**：小明在瀏覽母親節禮物，看到幾個不錯的商品，但還沒決定要買哪個
**使用前**：小明必須開多個分頁或截圖記錄商品，很不方便
**使用後**：小明可以將商品加入購物車，稍後再回來比較和決定

### 情境 2：會員跨裝置購物
**角色**：會員（已登入）
**情境**：小華在手機上加入商品後，回到電腦想繼續購買
**使用前**：購物車資料無法同步，小華需要重新搜尋商品
**使用後**：小華在電腦上登入後，購物車資料自動同步，可直接結帳

---

## 功能範疇與邊界

### 本次包含的功能
- ✅ 新增商品至購物車
- ✅ 修改購物車內商品數量
- ✅ 刪除購物車內商品
- ✅ 購物車資料跨裝置同步（會員）
- ✅ 購物車商品庫存檢查

### 本次不包含的功能（未來版本考慮）
- ❌ 購物車商品推薦功能
- ❌ 購物車分享給他人
- ❌ 購物車優惠券自動套用

### 已知限制
- **技術限制**：購物車最多儲存 100 件商品（受後端資料庫限制）
- **業務限制**：訪客購物車資料保留 7 天（localStorage 容量考量）

---

## 外部依賴與技術約束

### 後端服務依賴
| 服務名稱 | 依賴內容 | 負責人 | 預計完成日 | 風險等級 | 備援方案 |
|---------|---------|--------|-----------|---------|---------|
| 購物車 API | 提供 CRUD 操作的 RESTful API | 後端工程師 A | 2025/02/15 | 🟢 低 | - |
| 庫存檢查 API | 即時檢查商品庫存狀態 | 後端工程師 B | 2025/02/20 | 🟡 中 | 若延遲，前端暫時跳過即時檢查，結帳時再統一檢查庫存 |

### 第三方服務依賴
| 服務名稱 | 依賴內容 | 預計完成日 | 風險等級 | 備援方案 |
|---------|---------|-----------|---------|---------|
| CDN 圖片服務 | 提供商品圖片載入 | - | 🟡 中 | 若 CDN 異常，改用本地圖片快取或顯示預設圖片 |

### 開發順序約束
1. 必須先完成「購物車 API」才能開始前端開發
2. 「庫存檢查功能」可與購物車並行開發，但上線前必須完成
   - **備援方案**：若「庫存檢查 API」延遲，先上線不含即時檢查的版本，結帳時才檢查庫存

### 技術約束
- 前端需支援 IE 11 以上瀏覽器
- localStorage 儲存上限為 5MB
- API 請求逾時時間設定為 5 秒

---

## 互動流程與使用者行為

### 主要流程：新增商品至購物車

#### 流程圖
[此處插入線框圖或流程圖]

#### 流程說明
1. 使用者在商品頁點擊「加入購物車」按鈕
2. 系統檢查商品庫存
   - 若庫存 > 0：顯示「已加入購物車」提示，更新購物車數量
   - 若庫存 = 0：顯示「商品已售完」提示，按鈕變為灰色不可點擊
3. 使用者可選擇「繼續購物」或「前往購物車」

### 替代流程：使用者修改商品數量

#### 流程說明
1. 使用者在購物車頁面修改商品數量
2. 系統即時檢查庫存
   - 若修改後數量 ≤ 庫存：更新數量，重新計算總價
   - 若修改後數量 > 庫存：顯示「庫存不足」提示，數量自動調整為最大可購買數量
3. 使用者可繼續修改其他商品或結帳

### 異常流程：網路異常

#### 流程說明
1. 使用者點擊「加入購物車」後，網路連線中斷
2. 系統顯示「網路異常，請稍後再試」提示
3. 按鈕恢復可點擊狀態，使用者可重試

---

## 功能詳述

### 功能 1：新增商品至購物車 [設計稿連結](https://figma.com/xxx)

#### 功能描述
使用者可在商品頁點擊「加入購物車」按鈕，將商品加入購物車。系統會即時檢查庫存，並更新購物車數量顯示。

#### 前置條件
1. 商品狀態為「上架中」
2. 商品庫存 > 0

#### 驗收標準（Given/When/Then）

**正常情境**
- **Given** 使用者在商品頁，且商品庫存 > 0
- **When** 使用者點擊「加入購物車」按鈕
- **Then**
  - 顯示「已加入購物車」綠色提示（3 秒後自動消失）
  - 購物車圖示上的數量 +1
  - 按鈕文字變更為「已在購物車」（3 秒後恢復）

**庫存不足情境**
- **Given** 使用者在商品頁，且商品庫存 = 0
- **When** 使用者查看商品頁
- **Then**
  - 「加入購物車」按鈕顯示為灰色不可點擊
  - 按鈕文字顯示為「已售完」

**重複加入情境**
- **Given** 商品已在購物車中
- **When** 使用者再次點擊「加入購物車」
- **Then**
  - 購物車內該商品數量 +1
  - 若加入後數量 > 庫存，顯示「庫存不足」紅色提示，數量不變

**網路異常情境**
- **Given** 使用者點擊「加入購物車」
- **When** 網路連線中斷或 API 回應超時（> 5 秒）
- **Then**
  - 顯示「網路異常，請稍後再試」紅色提示
  - 按鈕恢復可點擊狀態

---

### 功能 2：修改購物車商品數量 [設計稿連結](https://figma.com/xxx)

#### 功能描述
使用者可在購物車頁面透過「+」「-」按鈕或直接輸入數字，修改商品購買數量。

#### 前置條件
1. 購物車內至少有一件商品
2. 使用者在購物車頁面

#### 驗收標準（Given/When/Then）

**增加數量**
- **Given** 購物車內有商品 A（數量 = 2，庫存 = 10）
- **When** 使用者點擊「+」按鈕
- **Then**
  - 商品數量變為 3
  - 小計金額即時更新
  - 總金額即時更新

**減少數量至 1**
- **Given** 購物車內有商品 A（數量 = 2）
- **When** 使用者點擊「-」按鈕
- **Then**
  - 商品數量變為 1
  - 小計金額即時更新
  - 總金額即時更新

**減少數量至 0**
- **Given** 購物車內有商品 A（數量 = 1）
- **When** 使用者點擊「-」按鈕
- **Then**
  - 顯示確認對話框：「確定要移除此商品？」
  - 使用者點擊「確定」→ 商品從購物車移除
  - 使用者點擊「取消」→ 數量維持為 1

**直接輸入數量**
- **Given** 購物車內有商品 A（庫存 = 10）
- **When** 使用者在數量欄位輸入「5」
- **Then**
  - 商品數量變為 5
  - 小計金額即時更新

**輸入數量超過庫存**
- **Given** 購物車內有商品 A（庫存 = 10）
- **When** 使用者在數量欄位輸入「15」
- **Then**
  - 顯示「庫存不足，最多只能購買 10 件」紅色提示
  - 數量自動調整為 10

---

## 資料與規則定義

### 購物車資料結構

#### 訪客購物車（localStorage）
```json
{
  "cartId": "guest_20250203_abc123",
  "items": [
    {
      "productId": "P001",
      "productName": "商品名稱",
      "quantity": 2,
      "price": 1000,
      "imageUrl": "https://example.com/image.jpg"
    }
  ],
  "totalAmount": 2000,
  "createdAt": "2025-02-03T10:30:00Z",
  "updatedAt": "2025-02-03T10:35:00Z"
}
```

#### 會員購物車（後端 API）
```json
{
  "cartId": "member_12345_cart",
  "userId": "U12345",
  "items": [
    {
      "productId": "P001",
      "productName": "商品名稱",
      "quantity": 2,
      "price": 1000,
      "imageUrl": "https://example.com/image.jpg",
      "stock": 50
    }
  ],
  "totalAmount": 2000,
  "createdAt": "2025-02-03T10:30:00Z",
  "updatedAt": "2025-02-03T10:35:00Z"
}
```

### 欄位說明與驗證規則

| 欄位名稱 | 型別 | 必填 | 驗證規則 | 說明 |
|---------|------|------|---------|------|
| cartId | String | ✅ | - | 購物車唯一識別碼 |
| userId | String | ❌ | - | 會員 ID（訪客為空） |
| productId | String | ✅ | 格式：P + 3 位數字 | 商品 ID |
| productName | String | ✅ | 長度 ≤ 100 字元 | 商品名稱 |
| quantity | Integer | ✅ | 1 ≤ quantity ≤ 999 | 購買數量 |
| price | Integer | ✅ | ≥ 0 | 商品單價（單位：元） |
| stock | Integer | ✅ | ≥ 0 | 商品庫存 |
| totalAmount | Integer | ✅ | ≥ 0 | 總金額（自動計算） |

### 資料流向

```
[前端] → [後端 API] → [資料庫]
  ↓           ↓            ↓
加入商品   檢查庫存    儲存購物車
  ↓           ↓            ↓
顯示結果   回傳結果    更新資料
```

### 業務規則
1. **購物車數量上限**：訪客購物車最多 50 件商品，會員購物車最多 100 件商品
2. **商品數量上限**：單一商品最多購買 999 件
3. **資料保留期限**：訪客購物車資料保留 7 天，會員購物車永久保留
4. **價格計算規則**：總金額 = Σ (商品單價 × 購買數量)

---

## 邊界條件與異常處理

### 資料邊界
| 情境 | 系統行為 | UI 顯示 |
|------|---------|---------|
| 購物車為空 | 顯示空狀態頁面 | 「購物車是空的，去逛逛吧！」+ 推薦商品 |
| 購物車商品數量 = 上限（50/100） | 禁止再加入商品 | 「購物車已滿，請先結帳或移除部分商品」 |
| 商品數量 = 999 | 「+」按鈕變灰色不可點擊 | - |
| 商品庫存 = 0 | 商品顯示「已售完」標籤 | 「此商品已售完」 |
| 輸入數量為非數字 | 自動恢復為原數量 | 「請輸入有效數量」紅色提示 |
| 輸入數量為負數或 0 | 自動恢復為原數量 | 「數量需大於 0」紅色提示 |

### 權限處理
| 情境 | 系統行為 | UI 顯示 |
|------|---------|---------|
| 訪客存取會員限定功能 | 跳轉至登入頁 | 「請先登入以繼續」 |
| 會員 Session 過期 | 強制登出，跳轉至登入頁 | 「登入逾時，請重新登入」 |

### 系統異常
| 情境 | 系統行為 | UI 顯示 |
|------|---------|---------|
| API 回應超時（> 5 秒） | 顯示錯誤提示，允許重試 | 「網路異常，請稍後再試」 |
| API 回應 500 錯誤 | 顯示錯誤提示，聯絡客服 | 「系統異常，請聯絡客服」 |
| localStorage 容量不足 | 清除過期資料，重試儲存 | 若仍失敗：「儲存失敗，請清理瀏覽器資料」 |
| 網路斷線 | 顯示離線狀態，禁用需網路的功能 | 「目前處於離線狀態」 |

### 操作衝突
| 情境 | 系統行為 | UI 顯示 |
|------|---------|---------|
| 商品在購物車中被其他使用者搶購一空 | 自動移除該商品，發送通知 | 「[商品名稱] 已售完，已自動移除」 |
| 使用者在多裝置同時修改購物車 | 以最後一次操作為準（後端時間戳） | - |

---

## 優先級

### 優先級定義
- **必做（P0）**：解決核心痛點，沒有此功能產品無法運作
- **中（P1）**：改善使用者體驗，有明顯價值但不影響核心功能
- **低（P2）**：輔助性功能，提升便利性但非必要

### 功能優先級清單

| 功能 | 優先級 | 調整原因 |
|------|-------|---------|
| 新增商品至購物車 | P0 | 核心功能，沒有此功能產品無法運作 |
| 修改購物車商品數量 | P0 | 核心功能，使用者必須能調整數量 |
| 刪除購物車商品 | P0 | 核心功能，使用者必須能移除商品 |
| 購物車資料跨裝置同步（會員） | P0 | 核心功能，會員期望資料能同步 |
| 購物車商品庫存即時檢查 | P1 | 改善體驗，避免結帳時才發現缺貨 |
| 購物車商品圖片顯示 | P1 | 改善體驗，但不影響核心功能 |
| 購物車空狀態推薦商品 | P2 | 輔助功能，提升轉換率但非必要 |
| 購物車總價顯示折扣資訊 | P2 | 原為 P1，因技術依賴優惠券系統（尚未完成），調整為 P2 |

---

**文件結束**
