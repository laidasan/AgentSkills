# 8. 功能詳述

## 目的

詳細描述每個功能的實作細節、前置條件、驗收標準。

## 撰寫規範

### 基本結構

```markdown
## 功能詳述

### 功能 1：新增商品至購物車 [設計稿連結](https://figma.com/xxx)

#### 功能描述
使用者可在商品頁點擊「加入購物車」按鈕，將商品加入購物車。系統會即時檢查庫存，並更新購物車數量顯示。

#### 前置條件
1. 商品狀態為「上架中」
2. 商品庫存 > 0

#### 驗收標準（Given/When/Then）

**正常情境**
- **Given** 使用者在商品頁，且商品庫存 > 0
- **When** 使用者點擊「加入購物車」按鈕
- **Then**
  - 顯示「已加入購物車」綠色提示（3 秒後自動消失）
  - 購物車圖示上的數量 +1
  - 按鈕文字變更為「已在購物車」（3 秒後恢復）

**庫存不足情境**
- **Given** 使用者在商品頁，且商品庫存 = 0
- **When** 使用者查看商品頁
- **Then**
  - 「加入購物車」按鈕顯示為灰色不可點擊
  - 按鈕文字顯示為「已售完」

**重複加入情境**
- **Given** 商品已在購物車中
- **When** 使用者再次點擊「加入購物車」
- **Then**
  - 購物車內該商品數量 +1
  - 若加入後數量 > 庫存，顯示「庫存不足」紅色提示，數量不變

**網路異常情境**
- **Given** 使用者點擊「加入購物車」
- **When** 網路連線中斷或 API 回應超時（> 5 秒）
- **Then**
  - 顯示「網路異常，請稍後再試」紅色提示
  - 按鈕恢復可點擊狀態
```

## 關鍵要素

### 1. 功能描述
- **目的**：簡要說明這個功能是什麼、做什麼
- **長度**：1-3 句話
- **內容**：涵蓋主要操作、關鍵邏輯、預期結果

### 2. 設計稿連結
- **位置**：放在功能標題旁邊
- **格式**：使用 Markdown 連結格式
- **內容**：連結到 Figma、Sketch 等設計工具的具體頁面

### 3. 前置條件
- **定義**：功能執行前必須滿足的業務邏輯條件
- **類型**：
  - 資料狀態（如：商品狀態為「上架中」）
  - 使用者狀態（如：使用者已登入）
  - 系統狀態（如：API 服務正常運作）

**注意**：前置條件應為業務邏輯型，而非技術實作型

### 4. 驗收標準（Given/When/Then）
使用 BDD（Behavior-Driven Development）格式：
- **Given**：前提條件（使用者和系統的初始狀態）
- **When**：觸發動作（使用者執行的操作）
- **Then**：預期結果（系統的反應和狀態變化）

## Given/When/Then 撰寫原則

### Given（前提條件）
- 描述使用者和系統的初始狀態
- 可包含多個條件，用逗號或「且」連接
- 範例：
  - ✅ 使用者在商品頁，且商品庫存 > 0
  - ✅ 購物車內有商品 A（數量 = 2，庫存 = 10）

### When（觸發動作）
- 描述使用者執行的具體操作
- 應該是明確的、單一的動作
- 範例：
  - ✅ 使用者點擊「加入購物車」按鈕
  - ✅ 使用者在數量欄位輸入「5」

### Then（預期結果）
- 描述系統的反應和狀態變化
- 可包含多個結果，使用條列式呈現
- 應該具體且可驗證
- 範例：
  - ✅ 顯示「已加入購物車」綠色提示（3 秒後自動消失）
  - ✅ 購物車圖示上的數量 +1

## 情境類型

### 1. 正常情境（Happy Path）
- 最常見的成功路徑
- 每個功能都必須有

### 2. 邊界情境
- 極值測試（如：數量 = 0、數量 = 999）
- 空值測試（如：購物車為空）
- 上限測試（如：購物車滿）

### 3. 錯誤情境
- 驗證失敗（如：輸入非數字）
- 權限不足（如：訪客存取會員功能）
- 業務規則違反（如：庫存不足）

### 4. 異常情境
- 網路異常
- API 超時
- 系統錯誤

## 撰寫技巧

### 技巧 1：驗收標準要可測試
每個 Then 都應該能被測試人員或自動化測試驗證。

❌ **不可測試**：「使用者體驗良好」
✅ **可測試**：「顯示『已加入購物車』綠色提示（3 秒後自動消失）」

### 技巧 2：使用具體的數值和時間
❌ **模糊描述**：「提示一會兒後消失」
✅ **具體描述**：「提示 3 秒後自動消失」

### 技巧 3：區分「前置條件」和「Given」
- **前置條件**：功能層級的條件，適用於所有情境
- **Given**：情境層級的條件，針對特定情境

### 技巧 4：一個情境測試一件事
避免在一個情境中測試多個不相關的邏輯。

❌ **測試多件事**：
```markdown
**正常情境**
- Given 使用者在商品頁
- When 使用者點擊「加入購物車」並輸入數量
- Then 商品加入購物車且數量正確且價格計算正確
```

✅ **拆分情境**：
```markdown
**情境 1：加入商品**
- Given 使用者在商品頁
- When 使用者點擊「加入購物車」
- Then 商品加入購物車

**情境 2：輸入數量**
- Given 商品已在購物車中
- When 使用者輸入數量「5」
- Then 商品數量更新為 5
```

## 功能顆粒度判斷

### 何時拆分功能
- 不同的使用者操作步驟 → 拆開
- 不同的頁面或畫面 → 拆開
- 不同的業務邏輯 → 拆開

### 何時不拆分
- 同一個畫面的不同元件 → 不拆
- 同一個操作的不同反饋 → 不拆
- 緊密相關的子步驟 → 不拆

## 注意事項

1. **設計稿連結要有效**：確保連結可以正常開啟
2. **驗收標準要完整**：涵蓋正常、邊界、錯誤、異常情境
3. **描述要具體**：避免「體驗良好」、「效能不錯」等模糊描述
4. **與流程對應**：驗收標準應能對應到互動流程中的步驟
5. **測試人員能理解**：驗收標準應該讓測試人員可以直接據此撰寫測試案例

## 常見錯誤

❌ **錯誤示範 1**：驗收標準不具體
```markdown
**正常情境**
- Given 使用者在商品頁
- When 使用者點擊按鈕
- Then 商品加入購物車
```
**問題**：Then 太簡略，無法驗證具體行為

✅ **正確示範**：
```markdown
**正常情境**
- Given 使用者在商品頁，且商品庫存 > 0
- When 使用者點擊「加入購物車」按鈕
- Then
  - 顯示「已加入購物車」綠色提示（3 秒後自動消失）
  - 購物車圖示上的數量 +1
```

❌ **錯誤示範 2**：前置條件包含技術細節
```markdown
#### 前置條件
1. 購物車 API 已部署
2. 資料庫連線正常
```
**問題**：前置條件應為業務邏輯型，而非技術型

✅ **正確示範**：
```markdown
#### 前置條件
1. 商品狀態為「上架中」
2. 商品庫存 > 0
```

❌ **錯誤示範 3**：缺少異常情境
```markdown
#### 驗收標準

**正常情境**
[只有成功路徑]
```
**問題**：沒有考慮異常情況

✅ **正確示範**：
```markdown
#### 驗收標準

**正常情境**
[成功路徑]

**庫存不足情境**
[邊界情況]

**網路異常情境**
[異常處理]
```

## 適用場景

- ✅ 開發階段，工程師根據驗收標準實作功能
- ✅ 測試階段，測試人員根據驗收標準撰寫測試案例
- ✅ 驗收階段，PM 和測試人員檢查功能是否符合標準
- ✅ 維護階段，新成員理解功能的預期行為

## 與其他章節的關聯

- **互動流程與使用者行為**：流程中的步驟會對應到驗收標準
- **資料與規則定義**：驗收標準中涉及的資料應在資料章節定義
- **邊界條件與異常處理**：異常情境會對應到邊界條件章節
- **優先級**：每個功能都應標註優先級

## 驗收標準範本

```markdown
### 功能 X：[功能名稱] [設計稿連結](URL)

#### 功能描述
[1-3 句話說明功能]

#### 前置條件
1. [條件 1]
2. [條件 2]

#### 驗收標準（Given/When/Then）

**正常情境**
- Given [前提]
- When [動作]
- Then
  - [結果 1]
  - [結果 2]

**[邊界/錯誤/異常]情境**
- Given [前提]
- When [動作]
- Then [結果]
```

## 驗證檢查

完成此章節後，檢查以下項目：
- [ ] 每個功能都有功能描述、前置條件、驗收標準
- [ ] 設計稿連結已放在標題旁
- [ ] 驗收標準使用 Given/When/Then 格式
- [ ] 至少涵蓋正常、邊界、異常情境
- [ ] 所有 Then 都具體且可測試
- [ ] 與互動流程和使用者故事對應
